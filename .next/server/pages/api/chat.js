"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/chat";
exports.ids = ["pages/api/chat"];
exports.modules = {

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "firebase/firestore":
/*!*************************************!*\
  !*** external "firebase/firestore" ***!
  \*************************************/
/***/ ((module) => {

module.exports = import("firebase/firestore");;

/***/ }),

/***/ "(api)/./pages/api/chat.js":
/*!***************************!*\
  !*** ./pages/api/chat.js ***!
  \***************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/firestore */ \"firebase/firestore\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__]);\n([axios__WEBPACK_IMPORTED_MODULE_0__, firebase_firestore__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\nconst OPENAI_API_KEY = process.env.OPENAI_API_KEY;\nconst OPENAI_ORGANIZATION = process.env.OPENAI_ORGANIZATION;\nconst openai = axios__WEBPACK_IMPORTED_MODULE_0__[\"default\"].create({\n    baseURL: \"https://api.openai.com/v1\",\n    headers: {\n        \"Content-Type\": \"application/json\",\n        Authorization: `Bearer ${OPENAI_API_KEY}`,\n        \"OpenAI-Organization\": OPENAI_ORGANIZATION\n    }\n});\nasync function getFactsFromFirestore() {\n    const db = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getFirestore)();\n    const factListDoc = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(db, \"Facts\", \"factList\");\n    const docSnap = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDoc)(factListDoc);\n    if (docSnap.exists()) {\n        const data = docSnap.data();\n        return Object.values(data);\n    } else {\n        console.log(\"No facts found in Firestore.\");\n        return [];\n    }\n}\nfunction isAnswerRelevant(answer, factArray) {\n    const answerWords = answer.toLowerCase().split(\" \");\n    const factWords = factArray.map((fact)=>fact.toLowerCase().split(\" \")).flat();\n    const relevantWords = answerWords.filter((word)=>factWords.includes(word));\n    const relevanceThreshold = 0.1; // Adjust this value as needed. 0과 1 사이, 0.15면 답변 15%가 factarray와 일치하는경우 관련있다고 판단\n    const relevanceRatio = relevantWords.length / answerWords.length;\n    return relevanceRatio >= relevanceThreshold;\n}\nasync function handler(req, res) {\n    const { question  } = req.body;\n    if (!question) {\n        res.status(400).json({\n            error: \"No question provided.\"\n        });\n        return;\n    }\n    try {\n        const FACT = await getFactsFromFirestore();\n        const response = await openai.post(\"/chat/completions\", {\n            model: \"gpt-3.5-turbo\",\n            messages: [\n                {\n                    role: \"system\",\n                    content: `The following facts are available:\\n\\n${FACT.join(\"\\n\")}`\n                },\n                {\n                    role: \"user\",\n                    content: question\n                }\n            ],\n            temperature: 0.7,\n            max_tokens: 100\n        });\n        const answer = response.data.choices[0].message.content.trim();\n        if (answer === \"\") {\n            res.status(200).json({\n                answer: \"대답할 수 없는 질문입니다.\"\n            });\n        } else {\n            if (isAnswerRelevant(answer, FACT)) {\n                res.status(200).json({\n                    answer\n                });\n            } else {\n                res.status(200).json({\n                    answer: \"주어진 정보로는 대답할 수 없는 질문입니다. '질의응답' 페이지에서 실제 사람들에게 질문을 해보세요.\"\n                });\n            }\n        }\n    } catch (error) {\n        console.error(\"Error occurred:\", error); // Log the error to the console\n        console.error(\"Error response:\", error.response); // Log the error response to the console\n        res.status(500).json({\n            error: \"An error occurred while generating the answer.\",\n            details: error.message\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9wYWdlcy9hcGkvY2hhdC5qcy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBMEI7QUFDcUM7QUFFL0QsTUFBTUksaUJBQWlCQyxRQUFRQyxHQUFHLENBQUNGLGNBQWM7QUFDakQsTUFBTUcsc0JBQXNCRixRQUFRQyxHQUFHLENBQUNDLG1CQUFtQjtBQUUzRCxNQUFNQyxTQUFTUixvREFBWSxDQUFDO0lBQzFCVSxTQUFTO0lBQ1RDLFNBQVM7UUFDUCxnQkFBZ0I7UUFDaEJDLGVBQWUsQ0FBQyxPQUFPLEVBQUVSLGVBQWUsQ0FBQztRQUN6Qyx1QkFBdUJHO0lBQ3pCO0FBQ0Y7QUFFQSxlQUFlTSx3QkFBd0I7SUFDckMsTUFBTUMsS0FBS2IsZ0VBQVlBO0lBQ3ZCLE1BQU1jLGNBQWNiLHVEQUFHQSxDQUFDWSxJQUFJLFNBQVM7SUFDckMsTUFBTUUsVUFBVSxNQUFNYiwwREFBTUEsQ0FBQ1k7SUFFN0IsSUFBSUMsUUFBUUMsTUFBTSxJQUFJO1FBQ3BCLE1BQU1DLE9BQU9GLFFBQVFFLElBQUk7UUFDekIsT0FBT0MsT0FBT0MsTUFBTSxDQUFDRjtJQUN2QixPQUFPO1FBQ0xHLFFBQVFDLEdBQUcsQ0FBQztRQUNaLE9BQU8sRUFBRTtJQUNYLENBQUM7QUFDSDtBQUdBLFNBQVNDLGlCQUFpQkMsTUFBTSxFQUFFQyxTQUFTLEVBQUU7SUFDM0MsTUFBTUMsY0FBY0YsT0FBT0csV0FBVyxHQUFHQyxLQUFLLENBQUM7SUFDL0MsTUFBTUMsWUFBWUosVUFBVUssR0FBRyxDQUFDLENBQUNDLE9BQVNBLEtBQUtKLFdBQVcsR0FBR0MsS0FBSyxDQUFDLE1BQU1JLElBQUk7SUFDN0UsTUFBTUMsZ0JBQWdCUCxZQUFZUSxNQUFNLENBQUMsQ0FBQ0MsT0FBU04sVUFBVU8sUUFBUSxDQUFDRDtJQUV0RSxNQUFNRSxxQkFBcUIsS0FBSyxpRkFBaUY7SUFDakgsTUFBTUMsaUJBQWlCTCxjQUFjTSxNQUFNLEdBQUdiLFlBQVlhLE1BQU07SUFFaEUsT0FBT0Qsa0JBQWtCRDtBQUMzQjtBQUVlLGVBQWVHLFFBQVFDLEdBQUcsRUFBRUMsR0FBRyxFQUFFO0lBQzlDLE1BQU0sRUFBRUMsU0FBUSxFQUFFLEdBQUdGLElBQUlHLElBQUk7SUFFN0IsSUFBSSxDQUFDRCxVQUFVO1FBQ2JELElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7WUFBRUMsT0FBTztRQUF3QjtRQUN0RDtJQUNGLENBQUM7SUFFRCxJQUFJO1FBQ0YsTUFBTUMsT0FBTyxNQUFNbkM7UUFFbkIsTUFBTW9DLFdBQVcsTUFBTXpDLE9BQU8wQyxJQUFJLENBQUMscUJBQXFCO1lBQ3REQyxPQUFPO1lBQ1BDLFVBQVU7Z0JBQ1I7b0JBQUVDLE1BQU07b0JBQVVDLFNBQVMsQ0FBQyxzQ0FBc0MsRUFBRU4sS0FBS08sSUFBSSxDQUFDLE1BQU0sQ0FBQztnQkFBQztnQkFDdEY7b0JBQUVGLE1BQU07b0JBQVFDLFNBQVNYO2dCQUFTO2FBQ25DO1lBQ0RhLGFBQWE7WUFDYkMsWUFBWTtRQUNkO1FBRUEsTUFBTWpDLFNBQVN5QixTQUFTL0IsSUFBSSxDQUFDd0MsT0FBTyxDQUFDLEVBQUUsQ0FBQ0MsT0FBTyxDQUFDTCxPQUFPLENBQUNNLElBQUk7UUFDNUQsSUFBSXBDLFdBQVcsSUFBSTtZQUNqQmtCLElBQUlHLE1BQU0sQ0FBQyxLQUFLQyxJQUFJLENBQUM7Z0JBQUV0QixRQUFRO1lBQWtCO1FBQ25ELE9BQU87WUFDTCxJQUFJRCxpQkFBaUJDLFFBQVF3QixPQUFPO2dCQUNsQ04sSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRXRCO2dCQUFPO1lBQ2hDLE9BQU87Z0JBQ0xrQixJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUFFdEIsUUFBUTtnQkFBMkQ7WUFDNUYsQ0FBQztRQUNILENBQUM7SUFDSCxFQUFFLE9BQU91QixPQUFPO1FBQ2QxQixRQUFRMEIsS0FBSyxDQUFDLG1CQUFtQkEsUUFBUSwrQkFBK0I7UUFDeEUxQixRQUFRMEIsS0FBSyxDQUFDLG1CQUFtQkEsTUFBTUUsUUFBUSxHQUFHLHdDQUF3QztRQUMxRlAsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFQyxPQUFPO1lBQWtEYyxTQUFTZCxNQUFNWSxPQUFPO1FBQUM7SUFDekc7QUFDRixDQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2hhdGdiZDAzMTkvLi9wYWdlcy9hcGkvY2hhdC5qcz8xYzQ5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBheGlvcyBmcm9tIFwiYXhpb3NcIjtcbmltcG9ydCB7IGdldEZpcmVzdG9yZSwgZG9jLCBnZXREb2MgfSBmcm9tIFwiZmlyZWJhc2UvZmlyZXN0b3JlXCI7XG5cbmNvbnN0IE9QRU5BSV9BUElfS0VZID0gcHJvY2Vzcy5lbnYuT1BFTkFJX0FQSV9LRVk7XG5jb25zdCBPUEVOQUlfT1JHQU5JWkFUSU9OID0gcHJvY2Vzcy5lbnYuT1BFTkFJX09SR0FOSVpBVElPTjtcblxuY29uc3Qgb3BlbmFpID0gYXhpb3MuY3JlYXRlKHtcbiAgYmFzZVVSTDogXCJodHRwczovL2FwaS5vcGVuYWkuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7T1BFTkFJX0FQSV9LRVl9YCxcbiAgICBcIk9wZW5BSS1Pcmdhbml6YXRpb25cIjogT1BFTkFJX09SR0FOSVpBVElPTixcbiAgfSxcbn0pO1xuXG5hc3luYyBmdW5jdGlvbiBnZXRGYWN0c0Zyb21GaXJlc3RvcmUoKSB7XG4gIGNvbnN0IGRiID0gZ2V0RmlyZXN0b3JlKCk7XG4gIGNvbnN0IGZhY3RMaXN0RG9jID0gZG9jKGRiLCBcIkZhY3RzXCIsIFwiZmFjdExpc3RcIik7XG4gIGNvbnN0IGRvY1NuYXAgPSBhd2FpdCBnZXREb2MoZmFjdExpc3REb2MpO1xuXG4gIGlmIChkb2NTbmFwLmV4aXN0cygpKSB7XG4gICAgY29uc3QgZGF0YSA9IGRvY1NuYXAuZGF0YSgpO1xuICAgIHJldHVybiBPYmplY3QudmFsdWVzKGRhdGEpO1xuICB9IGVsc2Uge1xuICAgIGNvbnNvbGUubG9nKFwiTm8gZmFjdHMgZm91bmQgaW4gRmlyZXN0b3JlLlwiKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn1cblxuXG5mdW5jdGlvbiBpc0Fuc3dlclJlbGV2YW50KGFuc3dlciwgZmFjdEFycmF5KSB7XG4gIGNvbnN0IGFuc3dlcldvcmRzID0gYW5zd2VyLnRvTG93ZXJDYXNlKCkuc3BsaXQoXCIgXCIpO1xuICBjb25zdCBmYWN0V29yZHMgPSBmYWN0QXJyYXkubWFwKChmYWN0KSA9PiBmYWN0LnRvTG93ZXJDYXNlKCkuc3BsaXQoXCIgXCIpKS5mbGF0KCk7XG4gIGNvbnN0IHJlbGV2YW50V29yZHMgPSBhbnN3ZXJXb3Jkcy5maWx0ZXIoKHdvcmQpID0+IGZhY3RXb3Jkcy5pbmNsdWRlcyh3b3JkKSk7XG5cbiAgY29uc3QgcmVsZXZhbmNlVGhyZXNob2xkID0gMC4xOyAvLyBBZGp1c3QgdGhpcyB2YWx1ZSBhcyBuZWVkZWQuIDDqs7wgMSDsgqzsnbQsIDAuMTXrqbQg64u167OAIDE1JeqwgCBmYWN0YXJyYXnsmYAg7J287LmY7ZWY64qU6rK97JqwIOq0gOugqOyeiOuLpOqzoCDtjJDri6hcbiAgY29uc3QgcmVsZXZhbmNlUmF0aW8gPSByZWxldmFudFdvcmRzLmxlbmd0aCAvIGFuc3dlcldvcmRzLmxlbmd0aDtcblxuICByZXR1cm4gcmVsZXZhbmNlUmF0aW8gPj0gcmVsZXZhbmNlVGhyZXNob2xkO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzKSB7XG4gIGNvbnN0IHsgcXVlc3Rpb24gfSA9IHJlcS5ib2R5O1xuXG4gIGlmICghcXVlc3Rpb24pIHtcbiAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiBcIk5vIHF1ZXN0aW9uIHByb3ZpZGVkLlwiIH0pO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIHRyeSB7XG4gICAgY29uc3QgRkFDVCA9IGF3YWl0IGdldEZhY3RzRnJvbUZpcmVzdG9yZSgpO1xuICAgIFxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgb3BlbmFpLnBvc3QoXCIvY2hhdC9jb21wbGV0aW9uc1wiLCB7XG4gICAgICBtb2RlbDogXCJncHQtMy41LXR1cmJvXCIsXG4gICAgICBtZXNzYWdlczogW1xuICAgICAgICB7IHJvbGU6IFwic3lzdGVtXCIsIGNvbnRlbnQ6IGBUaGUgZm9sbG93aW5nIGZhY3RzIGFyZSBhdmFpbGFibGU6XFxuXFxuJHtGQUNULmpvaW4oXCJcXG5cIil9YCB9LFxuICAgICAgICB7IHJvbGU6IFwidXNlclwiLCBjb250ZW50OiBxdWVzdGlvbiB9LFxuICAgICAgXSxcbiAgICAgIHRlbXBlcmF0dXJlOiAwLjcsXG4gICAgICBtYXhfdG9rZW5zOiAxMDAsXG4gICAgfSk7XG5cbiAgICBjb25zdCBhbnN3ZXIgPSByZXNwb25zZS5kYXRhLmNob2ljZXNbMF0ubWVzc2FnZS5jb250ZW50LnRyaW0oKTtcbiAgICBpZiAoYW5zd2VyID09PSBcIlwiKSB7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IGFuc3dlcjogXCLrjIDri7XtlaAg7IiYIOyXhuuKlCDsp4jrrLjsnoXri4jri6QuXCIgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChpc0Fuc3dlclJlbGV2YW50KGFuc3dlciwgRkFDVCkpIHtcbiAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oeyBhbnN3ZXIgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IGFuc3dlcjogXCLso7zslrTsp4Qg7KCV67O066Gc64qUIOuMgOuLte2VoCDsiJgg7JeG64qUIOyniOusuOyeheuLiOuLpC4gJ+yniOydmOydkeuLtScg7Y6Y7J207KeA7JeQ7IScIOyLpOygnCDsgqzrnozrk6Tsl5Dqsowg7KeI66y47J2EIO2VtOuztOyEuOyalC5cIiB9KTtcbiAgICAgIH1cbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkVycm9yIG9jY3VycmVkOlwiLCBlcnJvcik7IC8vIExvZyB0aGUgZXJyb3IgdG8gdGhlIGNvbnNvbGVcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgcmVzcG9uc2U6XCIsIGVycm9yLnJlc3BvbnNlKTsgLy8gTG9nIHRoZSBlcnJvciByZXNwb25zZSB0byB0aGUgY29uc29sZVxuICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IFwiQW4gZXJyb3Igb2NjdXJyZWQgd2hpbGUgZ2VuZXJhdGluZyB0aGUgYW5zd2VyLlwiLCBkZXRhaWxzOiBlcnJvci5tZXNzYWdlIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiYXhpb3MiLCJnZXRGaXJlc3RvcmUiLCJkb2MiLCJnZXREb2MiLCJPUEVOQUlfQVBJX0tFWSIsInByb2Nlc3MiLCJlbnYiLCJPUEVOQUlfT1JHQU5JWkFUSU9OIiwib3BlbmFpIiwiY3JlYXRlIiwiYmFzZVVSTCIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiZ2V0RmFjdHNGcm9tRmlyZXN0b3JlIiwiZGIiLCJmYWN0TGlzdERvYyIsImRvY1NuYXAiLCJleGlzdHMiLCJkYXRhIiwiT2JqZWN0IiwidmFsdWVzIiwiY29uc29sZSIsImxvZyIsImlzQW5zd2VyUmVsZXZhbnQiLCJhbnN3ZXIiLCJmYWN0QXJyYXkiLCJhbnN3ZXJXb3JkcyIsInRvTG93ZXJDYXNlIiwic3BsaXQiLCJmYWN0V29yZHMiLCJtYXAiLCJmYWN0IiwiZmxhdCIsInJlbGV2YW50V29yZHMiLCJmaWx0ZXIiLCJ3b3JkIiwiaW5jbHVkZXMiLCJyZWxldmFuY2VUaHJlc2hvbGQiLCJyZWxldmFuY2VSYXRpbyIsImxlbmd0aCIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJxdWVzdGlvbiIsImJvZHkiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJGQUNUIiwicmVzcG9uc2UiLCJwb3N0IiwibW9kZWwiLCJtZXNzYWdlcyIsInJvbGUiLCJjb250ZW50Iiwiam9pbiIsInRlbXBlcmF0dXJlIiwibWF4X3Rva2VucyIsImNob2ljZXMiLCJtZXNzYWdlIiwidHJpbSIsImRldGFpbHMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./pages/api/chat.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = (__webpack_exec__("(api)/./pages/api/chat.js"));
module.exports = __webpack_exports__;

})();